<div class="my-6 lg:my-10">
  @if (note(); as note) {
    <div class="mx-4 lg:mx-10">
      <div class="flex flex-col lg:flex-row gap-y-4 lg:gap-y-0 items-center justify-start lg:justify-between w-full">
        <div class="flex gap-x-4 items-center w-full lg:w-auto bg-background-200 lg:bg-transparent rounded-full lg:rounded-none">
          <jegyzi-avatar
            [profileId]="note.creatorId"
            size="lg"
            [editable]="false"
            [link]="'/profiles/' + note.creatorId"
            [profilPicEnabled]="note.creatorProfilPic"
          ></jegyzi-avatar>

          @if (loggedInUser() && loggedInUser()?.id !== note.creatorId) {
            @if (followedNote(); as followedNote) {}
            <button
              type="button"
              (click)="followedNote() ? unFollow() : follow()"
              class="relative w-8 h-8 text-center"
              [matTooltip]="followedNote() ? 'Jegyzet kikövetése' : 'Jegyzet követése'"
            >
              <span class="ph-heart ph-2x text-heart-100 text-center" [ngClass]="[followedNote() ? 'ph-fill' : 'ph']"></span>
              <span
                class="absolute text-[12px] text-center w-8 left-0 top-1.5 font-semibold"
                [ngClass]="[followedNote() ? 'text-white' : 'text-heart-100']"
                >{{ note.followersNumber }}</span
              >
            </button>
          } @else {
            <div class="relative w-8 h-8 text-center" matTooltip="Jegyzet követői">
              <span class="ph-fill ph-heart ph-2x text-heart-100 text-center"></span>
              <span class="absolute text-white text-[12px] text-center w-8 left-0 top-1.5 font-semibold">{{ note.followersNumber }}</span>
            </div>
          }
          <div class="font-semibold text-primary-500 text-2xl">{{ note.title }}</div>
        </div>

        <div class="flex gap-x-4 justify-between lg:justify-normal items-center w-full lg:w-auto mx-2 lg:mx-0">
          <div class="text-primary-600 font-semibold hidden lg:block">
            Utoljára módosítva: {{ (note.lastModify ? note.lastModify : note.created) | toDate | date: 'short' }}
          </div>
          @if (note.avarageStar) {
            <jegyzi-rating-component
              [currentRate]="note.avarageStar"
              [disabled]="true"
              (selectRate)="(undefined)"
            ></jegyzi-rating-component>

            <button class="btn-icon relative" (click)="modifyRequest()" matTooltip="Módosítási kérés küldése">
              <span class="ph ph-warning text-center"></span>
              @if (note.numberOfUpdateRequests > 0) {
                <div class="absolute -top-2 left-5 rounded-full bg-heart-100 w-min h-min text-[16px] px-1 text-white">
                  {{ note.numberOfUpdateRequests }}
                </div>
              }
            </button>
          }
        </div>
        <div class="flex gap-x-4 justify-between items-center w-full lg:hidden mx-2">
          <div class="text-primary-600 font-semibold self-start">
            Módosítva: {{ (note.lastModify ? note.lastModify : note.created) | toDate | date: 'short' }}
          </div>
          @if (!note.avarageStar) {
            <button class="btn-icon relative" (click)="modifyRequest()" matTooltip="Módosítási kérés küldése">
              <span class="ph ph-warning text-center"></span>
              @if (note.numberOfUpdateRequests) {
                <div class="absolute -top-2 left-5 rounded-full bg-heart-100 w-min h-min text-[16px] px-1 text-white">
                  {{ note.numberOfUpdateRequests }}
                </div>
              }
            </button>
          }
        </div>
      </div>
      <div class="my-6">
        <div class="flex flex-wrap gap-y-2 gap-x-4">
          @for (label of note.labels; track label.label.id) {
            <div class="note-label">{{ label.label.value }}</div>
          }
        </div>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-y-6 lg:gap-x-20 py-2 rounded-2xl">
      <div class="basis-full md:mr-10 lg:basis-3/4">
        <div class="mx-4 lg:mx-10 font-semibold text-primary-600 text-xl mb-3">{{ note.subTitle }}</div>
        <quill-editor class="w-full" [formControl]="noteForm"> </quill-editor>
        <div class="font-semibold text-primary-600 my-3 mx-6">Létrehozva: {{ note.created | toDate | date: 'short' }}</div>
      </div>
      <div class="flex flex-col gap-y-10 basis-full md:mx-10 lg:basis-1/4 mx-4 lg:mx-10">
        <jegyzi-note-review [note]="note" [loggedInUser]="loggedInUser()" (newReview)="newReview($event)"></jegyzi-note-review>
        <jegyzi-note-comment [note]="note" [loggedInUser]="loggedInUser()" (newComment)="newComment($event)"></jegyzi-note-comment>
      </div>
    </div>
  }
</div>
