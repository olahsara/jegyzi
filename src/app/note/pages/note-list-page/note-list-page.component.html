<jegyzi-title></jegyzi-title>
<div class="mx-20">
  @if(notes$() | async; as notes) {
  <form [formGroup]="filterForm" (submit)="filter()">
    <div class="flex w-[70%] justify-between mb-10 -mt-10">
      <div class="flex w-[80%] gap-8 items-center">
        <input class="searchbar" placeholder="Keress rá a jegyzet nevére" matInput type="text" formControlName="title" />
        <button type="submit">
          <span class="ph ph-magnifying-glass btn-icon"></span>
        </button>
      </div>
      <!--TODO: SORRENDEZÉS -->
      <button type="button" matTooltip="Rendezés">
        <span class="ph ph-funnel-simple btn-icon"></span>
      </button>
    </div>

    <div class="w-full gap-x-10 flex justify-between">
      <div class="flex flex-col gap-10 w-[70%]">
        @for (note of notes; track note.id) {

        <a [routerLink]="'/notes/' + note.id" class="flex gap-8 rounded-3xl bg-background-200 px-6 py-4 items-center">
          <jegyzi-avatar [profileId]="note.creatorId" [profilPicEnabled]="note.creatorProfilPic"></jegyzi-avatar>
          <div class="flex flex-col gap-1 text-primary-600">
            <div class="font-semibold mb-1">{{ note.title }}</div>
            <div class="text-sm">{{ note.subTitle }}</div>
            <div class="text-sm">Létrehozva: {{ note.created | toDate | date : 'short' }}</div>
            <div class="text-sm">Módosítva: {{ note.lastModify | toDate | date : 'short' }}</div>
          </div>
          <div class="flex flex-col mr-0 ml-auto self-start">
            <div class="relative w-8 h-8 text-center" matTooltip="Követők száma">
              <span class="ph-fill ph-heart ph-2x text-heart-100 text-center"></span>
              <span class="absolute text-white text-[12px] text-center w-8 left-0 top-1.5 font-semibold">{{
                note.followers ? note.followers.length : 0
              }}</span>
            </div>
          </div>
        </a>
        }
      </div>
      <div class="flex flex-col w-1/4 gap-y-6">
        <div class="bg-background-200 rounded-3xl px-6 py-4 text-sm">
          <span class="font-semibold text-lg text-primary-600 mb-10">Keresés címke alapján</span>
          @if(labels$ | async; as labels) { @for (label of labels; track label.id) {
          <div class="m-4">
            <span class="text-primary-600 font-semibold">{{ label.name }}</span>
            <div class="flex gap-x-4">
              <jegyzi-label-group [items]="label" [(control)]="filterForm.controls.labels"></jegyzi-label-group>
            </div>
          </div>
          } }
        </div>

        <div class="bg-background-200 rounded-3xl px-6 py-4 text-sm">
          <span class="font-semibold text-lg text-primary-600 mb-10">Egyéb jellemzők</span>
          @if(users$ |async; as users) {
          <div class="form-control w-full">
            <div class="label">Feltöltő neve</div>
            <mat-select formControlName="creatorId" class="w-full">
              <mat-option>Nem adom meg</mat-option>

              @for(user of users; track user.id) {
              <mat-option [value]="user.id">{{ user | name }}</mat-option>
              }
            </mat-select>
          </div>
          }
          <div class="form-control !flex-row !justify-between items-center">
            <div class="label">Követők száma</div>
            <input matInput type="number" formControlName="followersNumber" class="w-24" />
          </div>

          <div class="form-control">
            <div class="flex justify-between items-center">
              <div class="label">Létrehozás dátuma</div>
              <mat-datepicker-toggle matIconSuffix [for]="createdDatePicker"></mat-datepicker-toggle>
            </div>
            <mat-date-range-input [formGroup]="filterForm.controls.createdDate" [rangePicker]="createdDatePicker">
              <input matStartDate formControlName="createdDateMin" />
              <input matEndDate formControlName="createdDateMax" />
            </mat-date-range-input>

            <mat-date-range-picker #createdDatePicker></mat-date-range-picker>
          </div>

          <div class="form-control">
            <div class="flex justify-between items-center">
              <div class="label">Módosítás dátuma</div>
              <mat-datepicker-toggle matIconSuffix [for]="lastModifiedDatePicker"></mat-datepicker-toggle>
            </div>
            <mat-date-range-input [formGroup]="filterForm.controls.lastModifiedDate" [rangePicker]="lastModifiedDatePicker">
              <input matStartDate formControlName="lastModifiedMin" />
              <input matEndDate formControlName="lastModifiedMax" />
            </mat-date-range-input>

            <mat-date-range-picker #lastModifiedDatePicker></mat-date-range-picker>
          </div>
        </div>
        <button type="submit" class="btn-small btn-light self-end">Keresés</button>
      </div>
    </div>
  </form>
  }
</div>
